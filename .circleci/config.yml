version: 2.0

jobs:
    build:
        docker:
            - image: circleci/openjdk:9-jdk-sid-node-browsers
        steps:

            - checkout

            - restore_cache:
                  key: circleci-demo-java-spring-{{ checksum "pom.xml" }}

            - run: mvn dependency:go-offline

            - save_cache:
                  paths:
                      - ~/.m2
                  key: circleci-demo-java-spring-{{ checksum "pom.xml" }}

            - run: mvn test

            - store_test_results:
                  path: target/surefire-reports

            - store_artifacts:
                  path: target/bookmanagement.jar
destination: libs

general:
    artifacts:
        - "build/reports/jacoco"

test:
    post:
        - if [ -e ./gradlew ]; then ./gradlew jacocoTestReport;else gradle jacocoTestReport;fi
        - bash <(curl -s https://codecov.io/bash)
